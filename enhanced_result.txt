ðŸ§ª Enhanced Adversarial Detection Test Suite
============================================================

=== Testing Feature Extraction ===
âœ… Normal prompt feature extraction works
âœ… Suspicious prompt feature extraction works
âœ… ESA-like prompt feature extraction works

=== Testing ESA Detection ===
âœ… ESA detection correctly ignores normal prompts
âœ… ESA detection correctly identifies attacks

=== Testing CAP Detection ===
âœ… CAP detection correctly ignores normal prompts
âœ… CAP detection correctly identifies attacks

=== Testing Multi-granularity Detection ===
âœ… Multi-granularity detection works for inconsistent levels
âœ… Multi-granularity detection correctly ignores consistent levels

=== Testing Ensemble Detection ===
âœ… Ensemble detection returns valid results
âœ… Ensemble uncertainty quantification works

=== Testing Dynamic Thresholds ===
âœ… Initial thresholds: {'esa': 0.6, 'cap': 0.5, 'ensemble': 0.5, 'multi_granularity': 0.6}
âœ… Updated thresholds: {'esa': 0.6066666666666667, 'cap': 0.5066666666666667, 'ensemble': 0.5066666666666667, 'multi_granularity': 0.6066666666666667}
âœ… Dynamic threshold adjustment works
âœ… Threshold statistics retrieval works

=== Testing Performance ===
âœ… Processed 8 prompts in 0.25ms
âœ… Average processing time: 0.03ms per prompt
âœ… Performance target met (<50ms per prompt)
âœ… Detected 3 malicious prompts out of 8
âœ… Processing time consistency verified

=== Testing End-to-End Integration ===
âœ… Case 1: Simple benign query - Expected: Benign, Got: Benign (Confidence: 0.00)
âœ… Case 2: Classic prompt injection - Expected: Malicious, Got: Malicious (Confidence: 0.57)
âŒ Case 3: Potential ESA attack - Expected: Malicious, Got: Benign (Confidence: 0.00)
âœ… Case 4: Legitimate technical question - Expected: Benign, Got: Benign (Confidence: 0.00)
âœ… Integration accuracy: 75.00% (3/4)

============================================================
ðŸŽ¯ Enhanced Detection Test Results:
âœ… PASS: feature_extraction
âœ… PASS: esa_detection
âœ… PASS: cap_detection
âœ… PASS: multi_granularity_detection
âœ… PASS: ensemble_detection
âœ… PASS: dynamic_thresholds
âœ… PASS: performance
âœ… PASS: integration

ðŸ Overall: âœ… ALL TESTS PASSED
